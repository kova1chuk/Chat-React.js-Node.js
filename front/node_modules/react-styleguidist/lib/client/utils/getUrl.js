import "core-js/modules/es.array.concat";
import "core-js/modules/es.array.includes";
import "core-js/modules/es.array.join";
import "core-js/modules/es.array.map";
import "core-js/modules/es.function.name";
import "core-js/modules/es.string.includes";
import "core-js/modules/es.string.replace";
import "core-js/modules/es.string.anchor";

/**
 * Get component / section URL.
 *
 * @param {string} $.name Name
 * @param {string} $.slug Slug
 * @param {number} $.example Example index
 * @param {boolean} $.anchor Anchor?
 * @param {boolean} $.isolated Isolated mode?
 * @param {boolean} $.nochrome No chrome? (Can be combined with anchor or isolated)
 * @param {boolean} $.absolute Absolute URL? (Can be combined with other flags)
 * @param {object} [location] Location object (will use current page location by default)
 * @return {string}
 */
export default function getUrl(_temp, _temp2) {
  var _ref = _temp === void 0 ? {} : _temp,
      name = _ref.name,
      slug = _ref.slug,
      example = _ref.example,
      anchor = _ref.anchor,
      isolated = _ref.isolated,
      nochrome = _ref.nochrome,
      absolute = _ref.absolute,
      hashPath = _ref.hashPath,
      id = _ref.id,
      takeHash = _ref.takeHash;

  var _ref2 = _temp2 === void 0 ? window.location : _temp2,
      origin = _ref2.origin,
      pathname = _ref2.pathname,
      _ref2$hash = _ref2.hash,
      hash = _ref2$hash === void 0 ? '' : _ref2$hash;

  var url = pathname;
  var currentHash = hash.indexOf('?') > -1 ? hash.substring(0, hash.indexOf('?')) : hash;

  if (takeHash) {
    url += currentHash;
  }

  if (nochrome) {
    url += '?nochrome';
  }

  var encodedName = encodeURIComponent(name);

  if (anchor) {
    url += "#" + slug;
  } else if (isolated || nochrome) {
    url += buildIsolatedOrNoChromeFragment({
      currentHash: currentHash,
      encodedName: encodedName
    });
  }

  if (hashPath) {
    var encodedHashPath = hashPath.map(encodeURIComponent);

    if (!id) {
      encodedHashPath = [].concat(encodedHashPath, [encodedName]);
    }

    url += "#/" + encodedHashPath.join('/');
  }

  if (id) {
    url += "?id=" + slug;
  }

  if (example !== undefined) {
    url += "/" + example;
  }

  if (absolute) {
    return origin + url;
  }

  return url;
}
/**
 * Gets the URL fragment for an isolated or nochrome link.
 *
 * @param {string} $.currentHash The current hash fragment of the page
 * @param {string} $.encodedName The URL encoded name of the component
 * @return {string}
 */

function buildIsolatedOrNoChromeFragment(_ref3) {
  var currentHash = _ref3.currentHash,
      encodedName = _ref3.encodedName;
  var stripFragment = /^#\/?/;
  var stripTrailingSlash = /\/$/;
  var currentHashPath = // skip if we are already using `#!/`
  currentHash && !currentHash.includes('#!/') ? currentHash.replace(stripFragment, '').replace(stripTrailingSlash, '') + '/' : '';
  return "#!/" + currentHashPath + encodedName;
}